<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title>vue-ac-template</title>
  <link rel="stylesheet" type="text/css" href="./static/apicloud/css/api.css" />
  <link rel="stylesheet" type="text/css" href="./static/apicloud/css/style.css" />
  <style>
    header{
      background-color: #ffffff;
      box-shadow: 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12), 0 3px 1px -2px rgba(0,0,0,.2)
    }
    header ul li{ color: #767676;  padding-top: 10px; padding-bottom: 10px; background: url() no-repeat center 2px; background-size: auto 30px; text-align: center; }
    header ul li.active{ color: #2baff5; }
    header #slider {
      position: absolute;
      left: 0;
      bottom: 0;
      height: 2px;
      width: 25%;
      background-color: #2baff5;
    }
    .flex-con{
      overflow: auto
    }
  </style>
</head>

<body>
  <div id="wrap" class="flex-wrap flex-vertical">
    <header>
      <ul class="flex-wrap">
        <li tapmode="hover" data-tab="survey" onclick="switchBtn(this);" class="flex-con active">概况</li>
        <li tapmode="hover" data-tab="accept" onclick="switchBtn(this);" class="flex-con">受理</li>
        <li tapmode="hover" data-tab="dispose" onclick="switchBtn(this);" class="flex-con">处置</li>
        <li tapmode="hover" data-tab="supervision" onclick="switchBtn(this);" class="flex-con">督查</li>
      </ul>
      <div id="slider"></div>
    </header>
    <div id="app" class="flex-con">
    </div>
  </div>
  <script type="text/javascript" src="./static/apicloud/js/api.js"></script>
  <script type="text/javascript" src="./static/js/tab-slider.js"></script>
  <script type="text/javascript" src="./static/js/init.js"></script>
  <script type="text/javascript">
    var headerList = $api.domAll('header li');
    var currentIdx = 0;
    var isHidden = false;
    $init(function () {
      $api.dom('#slider').style.width = api.winWidth / headerList.length
      api.addEventListener({
        name: 'kanbanHiddenChange'
      }, function (ret) {
        isHidden = ret.hidden
      })
      api.addEventListener({
        name: 'kanbanSizeChange'
      }, function (ret) {
        setTimeout(function () {
          var tag = headerList[currentIdx]
          switchBtn(tag, false);
        }, 200);
      });
      funInitGroup();
    })

    function funInitGroup() {
      var frames = [];
      for (var i = 0, len = headerList.length; i < len; i++) {
        var name = 'tab_' + headerList[i].dataset['tab']
        frames.push({
          name: name,
          pageParam: {
            refresh: true
          },
          url: './' + name + '.html',
          bgColor: 'rgba(0,0,0,0)',
          bounces: false
        })
      }
      api.openFrameGroup({
        name: 'group_kanban',
        scrollEnabled: true,
        rect: {
          x: 0,
          y: $api.dom('header').offsetHeight + 50,
          w: api.winWidth,
          h: $api.dom('#app').offsetHeight
        },
        index: 0,
        frames: frames
      }, function (ret, err) {
        switchBtn(headerList[ret.index], false);
      });
    }

    function switchBtn(tag, isSet) {
      if (tag == $api.dom('#footer li.active')) return;
      var index = 0;
      for (var i = 0, len = headerList.length; i < len; i++) {
        if (tag == headerList[i]) {
          index = i;
        } else {
          $api.removeCls(headerList[i], 'active');
        }
      }
      $api.addCls(headerList[index], 'active');
      var width = api.winWidth / headerList.length;
      $api.dom('#slider').style.width = width;
      setSliderTransform(index * width);
      api.setFrameGroupAttr({
        name: 'group_kanban',
        hidden: isHidden,
        rect: {
          x: 0,
          y: $api.dom('header').offsetHeight + 50,
          w: api.winWidth,
          h: $api.dom('#app').offsetHeight
        }
      })
      currentIdx = index;
      if (isSet === false) {
        return
      }
      api.setFrameGroupIndex({
        name: 'group_kanban',
        index: index
      });
    }

    function setSliderTransform(offset) {
      var slider = $api.dom('#slider')
      if (typeof offset === 'number') {
        offset = `${offset}px`
      }
      if (slider) {
        var TRANSFORM = $tab.prefixStyle('transform')
        var TRANSITION = $tab.prefixStyle('transition')
        slider.style[TRANSITION] = `${TRANSFORM} 0.2s linear`
        slider.style[TRANSFORM] = `translateX(${offset}) translateZ(0)`
      }
    }
  </script>
</body>

</html>
